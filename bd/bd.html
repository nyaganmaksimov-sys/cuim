<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Объединенная база данных магазинов и заведений Барнаула</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 12px 25px;
            background-color: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background-color: #3498db;
            color: white;
        }
        
        .tab:hover:not(.active) {
            background-color: #e9ecef;
        }
        
        .search-container {
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
        }
        
        #searchInput {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        #searchInput:focus {
            outline: none;
            border-color: #3498db;
        }
        
        #searchButton {
            padding: 12px 25px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        #searchButton:hover {
            background-color: #2980b9;
        }
        
        .establishments-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .establishment-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #eaeaea;
        }
        
        .establishment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .establishment-name {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #f1f1f1;
            padding-bottom: 8px;
        }
        
        .establishment-info {
            margin-bottom: 15px;
        }
        
        .establishment-info p {
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
        }
        
        .info-label {
            font-weight: 600;
            min-width: 120px;
            color: #7f8c8d;
        }
        
        .rating {
            display: inline-block;
            background-color: #27ae60;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .phone {
            color: #3498db;
            text-decoration: none;
        }
        
        .phone:hover {
            text-decoration: underline;
        }
        
        .notes-section {
            margin-top: 15px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .notes-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #7f8c8d;
        }
        
        .manager-select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .notes-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            min-height: 80px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .notes-display {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }
        
        .notes-author {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .save-notes {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .save-notes:hover {
            background-color: #27ae60;
        }
        
        .edit-notes {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            margin-left: 10px;
        }
        
        .edit-notes:hover {
            background-color: #2980b9;
        }
        
        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .password-modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .password-modal h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .password-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .password-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .password-submit {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .password-cancel {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.2rem;
            grid-column: 1 / -1;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .establishments-container {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-bottom: 5px;
                border-radius: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Объединенная база данных магазинов и заведений Барнаула</h1>
        
        <div class="tabs">
            <button class="tab active" data-tab="stores">Магазины</button>
            <button class="tab" data-tab="establishments">Кафе и рестораны</button>
        </div>
        
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Поиск по названию, адресу или категории...">
            <button id="searchButton">Поиск</button>
        </div>
        
        <div class="establishments-container" id="dataList">
            <!-- Данные будут загружены с помощью JavaScript -->
        </div>
        
        <div class="footer">
            <p>Объединенная база данных Барнаула | Данные обновлены</p>
        </div>
    </div>

    <!-- Модальное окно для ввода пароля -->
    <div class="password-modal" id="passwordModal">
        <div class="password-modal-content">
            <h3>Введите пароль для редактирования примечания</h3>
            <input type="password" class="password-input" id="passwordInput" placeholder="Пароль">
            <div class="password-buttons">
                <button class="password-cancel" id="passwordCancel">Отмена</button>
                <button class="password-submit" id="passwordSubmit">Подтвердить</button>
            </div>
        </div>
    </div>

    <script>
        // Данные менеджеров с паролями
        const managers = [
            { id: 1, name: "Иван Иванов", password: "ivan123" },
            { id: 2, name: "Петр Петров", password: "petr456" },
            { id: 3, name: "Мария Сидорова", password: "maria789" },
            { id: 4, name: "Анна Козлова", password: "anna000" }
        ];

        // Данные магазинов (извлечены из предоставленного файла)
        const storesData = [
            {
                "name": "GlobalDrive",
                "category": "Автоаккумуляторы, автозапчасти",
                "address": "Павловский тракт, 31/17, 1 этаж",
                "phone": "+7 (495) 655-33-49"
            },
            {
                "name": "Автобеби",
                "category": "Детские товары, автокресла",
                "address": "проспект Космонавтов, 0,1,1 этаж",
                "phone": "+7 (3852) 58-48-41"
            },
            // ... остальные данные магазинов из первого файла
            // Для краткости оставлю только несколько примеров
            {
                "name": "ZOON",
                "category": "Продукты питания",
                "address": "Краснодарский проспект, 47м, школьный этаж",
                "phone": "+7 (800) 359-46-10"
            },
            {
                "name": "Цветы для Вас",
                "category": "Цветы",
                "address": "Социалистический проспект, 60, 1 этаж",
                "phone": "+7 (929) 329-56-14"
            }
        ];

        // Данные заведений (извлечены из предоставленного файла)
        const establishmentsData = [
            {
                name: "Бирдок",
                type: "Бар",
                address: "Максима Горького, 8, 1 этаж",
                phone: "+7 (983) 331-1420",
                rating: "4.9",
                hours: "Открыто до 01:00"
            },
            {
                name: "Кинза и мата",
                type: "Бар",
                address: "Социалистический проспект, 11б, 1 этаж",
                phone: "+7 (9832) 50-94-77",
                rating: "4.8",
                hours: "Открыто до 00:00"
            },
            // ... остальные данные заведений из второго файла
            // Для краткости оставлю только несколько примеров
            {
                name: "Пили-швили",
                type: "Бар",
                address: "проспект Ленина, 44а, 2 этаж",
                phone: "+7 (9832) 20-29-20",
                rating: "5.0",
                hours: "Открыто до 00:00"
            },
            {
                name: "ZOON",
                type: "Рестораны - Бар",
                address: "проспект Ленина, 56, 1 этаж",
                phone: "+7 (3852) 59-69-99",
                rating: "4.2",
                hours: "Открыто до 23:00"
            }
        ];

        // Переменные для управления состоянием
        let currentTab = 'stores';
        let currentEditTarget = null;

        // Функция для отображения данных
        function displayData(data) {
            const container = document.getElementById('dataList');
            container.innerHTML = '';

            if (data.length === 0) {
                container.innerHTML = '<div class="no-results">По вашему запросу ничего не найдено</div>';
                return;
            }

            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'establishment-card';
                
                // Получаем сохраненные примечания из localStorage
                const savedNotes = localStorage.getItem(`notes-${item.name}`) || '';
                const savedManagerId = localStorage.getItem(`manager-${item.name}`) || '';
                const savedManager = managers.find(m => m.id.toString() === savedManagerId);
                
                card.innerHTML = `
                    <div class="establishment-name">${item.name}</div>
                    <div class="establishment-info">
                        <p><span class="info-label">${currentTab === 'stores' ? 'Категория:' : 'Тип:'}</span> ${currentTab === 'stores' ? item.category : item.type}</p>
                        <p><span class="info-label">Адрес:</span> ${item.address || 'Не указан'}</p>
                        <p><span class="info-label">Телефон:</span> <a href="tel:${item.phone}" class="phone">${item.phone}</a></p>
                        ${currentTab === 'establishments' ? `<p><span class="info-label">Рейтинг:</span> <span class="rating">${item.rating}</span></p>` : ''}
                        ${currentTab === 'establishments' ? `<p><span class="info-label">Часы работы:</span> ${item.hours || 'Не указаны'}</p>` : ''}
                    </div>
                    <div class="notes-section">
                        <div class="notes-label">Примечания:</div>
                        ${savedNotes ? `
                            <div class="notes-display">
                                <div class="notes-author">${savedManager ? `Автор: ${savedManager.name}` : ''}</div>
                                <div>${savedNotes}</div>
                            </div>
                            <button class="edit-notes" data-establishment="${item.name}">Редактировать примечания</button>
                        ` : `
                            <select class="manager-select" id="manager-${item.name}">
                                <option value="">Выберите менеджера</option>
                                ${managers.map(manager => `<option value="${manager.id}">${manager.name}</option>`).join('')}
                            </select>
                            <textarea class="notes-input" id="notes-${item.name}" placeholder="Добавьте свои примечания здесь..."></textarea>
                            <button class="save-notes" data-establishment="${item.name}">Сохранить примечания</button>
                        `}
                    </div>
                `;
                
                container.appendChild(card);
            });

            // Добавляем обработчики событий для кнопок сохранения примечаний
            document.querySelectorAll('.save-notes').forEach(button => {
                button.addEventListener('click', function() {
                    const establishmentName = this.getAttribute('data-establishment');
                    const notesInput = document.getElementById(`notes-${establishmentName}`);
                    const managerSelect = document.getElementById(`manager-${establishmentName}`);
                    const notes = notesInput.value;
                    const managerId = managerSelect.value;
                    
                    if (!managerId) {
                        alert('Пожалуйста, выберите менеджера');
                        return;
                    }
                    
                    // Сохраняем примечания и менеджера в localStorage
                    localStorage.setItem(`notes-${establishmentName}`, notes);
                    localStorage.setItem(`manager-${establishmentName}`, managerId);
                    
                    // Показываем подтверждение
                    const originalText = this.textContent;
                    this.textContent = 'Сохранено!';
                    this.style.backgroundColor = '#27ae60';
                    
                    setTimeout(() => {
                        // Обновляем отображение
                        loadCurrentTabData();
                    }, 1000);
                });
            });

            // Добавляем обработчики событий для кнопок редактирования примечаний
            document.querySelectorAll('.edit-notes').forEach(button => {
                button.addEventListener('click', function() {
                    const establishmentName = this.getAttribute('data-establishment');
                    currentEditTarget = establishmentName;
                    document.getElementById('passwordModal').style.display = 'flex';
                });
            });
        }

        // Функция для поиска данных
        function searchData(query, data) {
            const normalizedQuery = query.toLowerCase().trim();
            
            if (!normalizedQuery) {
                return data;
            }
            
            return data.filter(item => 
                item.name.toLowerCase().includes(normalizedQuery) ||
                (currentTab === 'stores' ? item.category.toLowerCase().includes(normalizedQuery) : item.type.toLowerCase().includes(normalizedQuery)) ||
                (item.address && item.address.toLowerCase().includes(normalizedQuery))
            );
        }

        // Функция для загрузки данных текущей вкладки
        function loadCurrentTabData() {
            const query = document.getElementById('searchInput').value;
            let data = currentTab === 'stores' ? storesData : establishmentsData;
            
            // Фильтруем данные по наличию телефона для заведений
            if (currentTab === 'establishments') {
                data = data.filter(establishment => 
                    establishment.phone && establishment.phone.trim() !== ""
                );
            }
            
            const results = searchData(query, data);
            displayData(results);
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Загружаем данные для активной вкладки
            loadCurrentTabData();
            
            // Обработчики для вкладок
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentTab = this.getAttribute('data-tab');
                    loadCurrentTabData();
                });
            });
            
            // Обработчик для поиска
            document.getElementById('searchButton').addEventListener('click', function() {
                loadCurrentTabData();
            });
            
            // Поиск при нажатии Enter
            document.getElementById('searchInput').addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    loadCurrentTabData();
                }
            });

            // Обработчики для модального окна пароля
            document.getElementById('passwordCancel').addEventListener('click', function() {
                document.getElementById('passwordModal').style.display = 'none';
                currentEditTarget = null;
                document.getElementById('passwordInput').value = '';
            });

            document.getElementById('passwordSubmit').addEventListener('click', function() {
                const password = document.getElementById('passwordInput').value;
                const savedManagerId = localStorage.getItem(`manager-${currentEditTarget}`) || '';
                const savedManager = managers.find(m => m.id.toString() === savedManagerId);
                
                if (savedManager && password === savedManager.password) {
                    // Пароль верный, разрешаем редактирование
                    const savedNotes = localStorage.getItem(`notes-${currentEditTarget}`) || '';
                    
                    // Создаем форму для редактирования
                    const card = document.querySelector(`[data-establishment="${currentEditTarget}"]`).closest('.establishment-card');
                    const notesSection = card.querySelector('.notes-section');
                    
                    notesSection.innerHTML = `
                        <div class="notes-label">Примечания:</div>
                        <select class="manager-select" id="manager-${currentEditTarget}">
                            <option value="">Выберите менеджера</option>
                            ${managers.map(manager => 
                                `<option value="${manager.id}" ${savedManagerId === manager.id.toString() ? 'selected' : ''}>${manager.name}</option>`
                            ).join('')}
                        </select>
                        <textarea class="notes-input" id="notes-${currentEditTarget}" placeholder="Добавьте свои примечания здесь...">${savedNotes}</textarea>
                        <button class="save-notes" data-establishment="${currentEditTarget}">Сохранить примечания</button>
                    `;
                    
                    // Добавляем обработчик для кнопки сохранения
                    const saveButton = notesSection.querySelector('.save-notes');
                    saveButton.addEventListener('click', function() {
                        const establishmentName = this.getAttribute('data-establishment');
                        const notesInput = document.getElementById(`notes-${establishmentName}`);
                        const managerSelect = document.getElementById(`manager-${establishmentName}`);
                        const notes = notesInput.value;
                        const managerId = managerSelect.value;
                        
                        if (!managerId) {
                            alert('Пожалуйста, выберите менеджера');
                            return;
                        }
                        
                        // Сохраняем примечания и менеджера в localStorage
                        localStorage.setItem(`notes-${establishmentName}`, notes);
                        localStorage.setItem(`manager-${establishmentName}`, managerId);
                        
                        // Показываем подтверждение
                        const originalText = this.textContent;
                        this.textContent = 'Сохранено!';
                        this.style.backgroundColor = '#27ae60';
                        
                        setTimeout(() => {
                            // Обновляем отображение
                            loadCurrentTabData();
                        }, 1000);
                    });
                    
                    document.getElementById('passwordModal').style.display = 'none';
                    currentEditTarget = null;
                    document.getElementById('passwordInput').value = '';
                } else {
                    alert('Неверный пароль');
                    document.getElementById('passwordInput').value = '';
                }
            });
        });
    </script>
</body>
</html>
