<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>База данных магазинов Барнаула</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4a6fa5;
            --primary-dark: #3a5980;
            --secondary: #f8f9fa;
            --accent: #e9ecef;
            --text: #333;
            --text-light: #666;
            --border: #ddd;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: #f5f5f5;
            color: var(--text);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent);
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--accent);
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .search-container {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        
        .search-box {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }
        
        .category-select {
            flex: 1;
            min-width: 200px;
            position: relative;
        }
        
        .category-toggle {
            width: 100%;
            padding: 10px 15px;
            background-color: white;
            border: 1px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .category-toggle:hover {
            border-color: var(--primary);
        }
        
        .category-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border);
            border-radius: 0 0 4px 4px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: var(--shadow);
        }
        
        .category-dropdown.show {
            display: block;
        }
        
        .category-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .category-item:hover {
            background-color: var(--secondary);
        }
        
        .category-item.active {
            background-color: var(--primary);
            color: white;
        }
        
        .stores-container {
            margin-top: 20px;
        }
        
        .category-section {
            margin-bottom: 25px;
            border: 1px solid var(--accent);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .category-header {
            background-color: var(--primary);
            color: white;
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .category-header:hover {
            background-color: var(--primary-dark);
        }
        
        .category-content {
            display: none;
            padding: 0;
        }
        
        .category-content.show {
            display: block;
        }
        
        .store-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .store-item:last-child {
            border-bottom: none;
        }
        
        .store-info {
            flex: 1;
        }
        
        .store-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .store-address, .store-phone {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 3px;
        }
        
        .store-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: all 0.2s;
            color: var(--text-light);
        }
        
        .btn:hover {
            color: var(--primary);
            background-color: var(--secondary);
        }
        
        .note-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .note-modal.show {
            display: flex;
        }
        
        .note-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .note-title {
            font-weight: 600;
            color: var(--primary);
        }
        
        .note-textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .note-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-secondary {
            background-color: var(--secondary);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background-color: var(--accent);
        }
        
        .note-indicator {
            color: #ffc107;
            margin-left: 5px;
        }
        
        .footer-note {
            font-style: italic;
            color: var(--text-light);
            margin-top: 30px;
            font-size: 0.85rem;
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid var(--accent);
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .search-container, .category-select {
                min-width: 100%;
            }
            
            .store-item {
                flex-direction: column;
            }
            
            .store-actions {
                margin-top: 10px;
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>База данных магазинов Барнаула</h1>
        </header>
        
        <div class="stats">
            <div><strong>Всего магазинов: 180</strong></div>
            <div>Крупные федеральные сети и магазины без телефонов исключены из базы</div>
        </div>

        <div class="controls">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchInput" class="search-box" placeholder="Поиск по названию, адресу или категории...">
            </div>
            
            <div class="category-select">
                <div class="category-toggle" id="categoryToggle">
                    <span>Все категории</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="category-dropdown" id="categoryDropdown">
                    <!-- Категории будут добавлены через JavaScript -->
                </div>
            </div>
        </div>

        <div id="storesContainer" class="stores-container">
            <!-- Магазины будут сгруппированы по категориям -->
        </div>
        
        <p class="footer-note">Примечание: Данные были извлечены из предоставленных файлов. Всего найдено 180 магазинов (исключены крупные федеральные сети и магазины без телефонов). Некоторые номера телефонов и адреса могут содержать опечатки или быть неполными. Рекомендуется уточнять информацию перед использованием.</p>
    </div>

    <!-- Модальное окно для заметок -->
    <div class="note-modal" id="noteModal">
        <div class="note-content">
            <div class="note-header">
                <div class="note-title" id="noteStoreName">Заметка для магазина</div>
                <button class="btn" id="closeNoteModal"><i class="fas fa-times"></i></button>
            </div>
            <textarea class="note-textarea" id="noteTextarea" placeholder="Добавьте заметку для этого магазина..."></textarea>
            <div class="note-actions">
                <button class="btn-secondary" id="cancelNote">Отмена</button>
                <button class="btn-primary" id="saveNote">Сохранить</button>
            </div>
        </div>
    </div>

    <script>
        // Данные магазинов (объединенные и отфильтрованные)
        const storesData = [
            // ... (ваши данные магазинов остаются без изменений)
            // Для экономии места я сократил этот блок, но в реальном коде он должен содержать все ваши данные
            {
                "name": "GlobalDrive",
                "category": "Автоаккумуляторы, автозапчасти",
                "address": "Павловский тракт, 31/17, 1 этаж",
                "phone": "+7 (495) 655-33-49"
            },
            // ... остальные магазины
        ];

        // Переменные для управления состоянием
        let currentStoreForNote = null;
        let notes = JSON.parse(localStorage.getItem('storeNotes')) || {};

        // Функция для группировки магазинов по категориям
        function groupStoresByCategory(stores) {
            const grouped = {};
            
            stores.forEach(store => {
                if (!grouped[store.category]) {
                    grouped[store.category] = [];
                }
                grouped[store.category].push(store);
            });
            
            return grouped;
        }

        // Функция для создания меню категорий
        function createCategoryMenu(categories) {
            const dropdown = document.getElementById('categoryDropdown');
            dropdown.innerHTML = '';
            
            // Элемент "Все категории"
            const allItem = document.createElement('div');
            allItem.className = 'category-item active';
            allItem.textContent = 'Все категории';
            allItem.addEventListener('click', () => {
                selectCategory('Все категории');
                showAllStores();
            });
            dropdown.appendChild(allItem);
            
            // Элементы для каждой категории
            categories.forEach(category => {
                const item = document.createElement('div');
                item.className = 'category-item';
                item.textContent = category;
                item.addEventListener('click', () => {
                    selectCategory(category);
                    showStoresByCategory(category);
                });
                dropdown.appendChild(item);
            });
        }

        // Функция для выбора категории
        function selectCategory(category) {
            const toggle = document.getElementById('categoryToggle');
            toggle.querySelector('span').textContent = category;
            
            // Обновляем активный элемент в выпадающем списке
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('active');
                if (item.textContent === category) {
                    item.classList.add('active');
                }
            });
            
            // Закрываем выпадающий список
            document.getElementById('categoryDropdown').classList.remove('show');
        }

        // Функция для отображения всех магазинов
        function showAllStores() {
            const container = document.getElementById('storesContainer');
            container.innerHTML = '';
            
            const groupedStores = groupStoresByCategory(storesData);
            const categories = Object.keys(groupedStores).sort();
            
            categories.forEach(category => {
                const categorySection = createCategorySection(category, groupedStores[category]);
                container.appendChild(categorySection);
            });
        }

        // Функция для отображения магазинов по категории
        function showStoresByCategory(category) {
            const container = document.getElementById('storesContainer');
            container.innerHTML = '';
            
            const filteredStores = storesData.filter(store => store.category === category);
            const categorySection = createCategorySection(category, filteredStores, true);
            container.appendChild(categorySection);
        }

        // Функция для создания секции категории
        function createCategorySection(category, stores, expanded = false) {
            const categorySection = document.createElement('div');
            categorySection.className = 'category-section';
            
            const categoryHeader = document.createElement('div');
            categoryHeader.className = 'category-header';
            categoryHeader.innerHTML = `
                <span>${category} (${stores.length})</span>
                <i class="fas fa-chevron-${expanded ? 'up' : 'down'}"></i>
            `;
            
            const categoryContent = document.createElement('div');
            categoryContent.className = `category-content ${expanded ? 'show' : ''}`;
            
            // Добавляем магазины в секцию
            stores.forEach(store => {
                const storeItem = document.createElement('div');
                storeItem.className = 'store-item';
                
                const hasNote = notes[store.name] ? true : false;
                
                storeItem.innerHTML = `
                    <div class="store-info">
                        <div class="store-name">${store.name} ${hasNote ? '<i class="fas fa-sticky-note note-indicator"></i>' : ''}</div>
                        <div class="store-address">${store.address}</div>
                        <div class="store-phone">${store.phone}</div>
                    </div>
                    <div class="store-actions">
                        <button class="btn note-btn" data-store="${store.name}">
                            <i class="fas fa-sticky-note"></i>
                        </button>
                    </div>
                `;
                
                categoryContent.appendChild(storeItem);
            });
            
            // Обработчик для раскрытия/скрытия категории
            categoryHeader.addEventListener('click', () => {
                const isExpanded = categoryContent.classList.contains('show');
                categoryContent.classList.toggle('show');
                categoryHeader.querySelector('i').className = isExpanded ? 
                    'fas fa-chevron-down' : 'fas fa-chevron-up';
            });
            
            categorySection.appendChild(categoryHeader);
            categorySection.appendChild(categoryContent);
            
            return categorySection;
        }

        // Функция для поиска магазинов
        function searchStores() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const container = document.getElementById('storesContainer');
            
            if (!searchText) {
                // Если поисковая строка пустая, показываем все магазины или выбранную категорию
                const selectedCategory = document.getElementById('categoryToggle').querySelector('span').textContent;
                if (selectedCategory === 'Все категории') {
                    showAllStores();
                } else {
                    showStoresByCategory(selectedCategory);
                }
                return;
            }
            
            // Фильтруем магазины по поисковому запросу
            const filteredStores = storesData.filter(store => 
                store.name.toLowerCase().includes(searchText) || 
                store.category.toLowerCase().includes(searchText) ||
                store.address.toLowerCase().includes(searchText)
            );
            
            // Группируем отфильтрованные магазины по категориям
            const groupedStores = groupStoresByCategory(filteredStores);
            const categories = Object.keys(groupedStores).sort();
            
            container.innerHTML = '';
            
            if (categories.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">По вашему запросу ничего не найдено.</p>';
                return;
            }
            
            categories.forEach(category => {
                const categorySection = createCategorySection(category, groupedStores[category], true);
                container.appendChild(categorySection);
            });
        }

        // Функции для работы с заметками
        function openNoteModal(storeName) {
            currentStoreForNote = storeName;
            document.getElementById('noteStoreName').textContent = `Заметка для магазина: ${storeName}`;
            document.getElementById('noteTextarea').value = notes[storeName] || '';
            document.getElementById('noteModal').classList.add('show');
        }

        function closeNoteModal() {
            document.getElementById('noteModal').classList.remove('show');
            currentStoreForNote = null;
        }

        function saveNote() {
            if (currentStoreForNote) {
                const noteText = document.getElementById('noteTextarea').value.trim();
                
                if (noteText) {
                    notes[currentStoreForNote] = noteText;
                } else {
                    delete notes[currentStoreForNote];
                }
                
                // Сохраняем заметки в localStorage
                localStorage.setItem('storeNotes', JSON.stringify(notes));
                
                // Обновляем отображение
                const selectedCategory = document.getElementById('categoryToggle').querySelector('span').textContent;
                if (selectedCategory === 'Все категории') {
                    showAllStores();
                } else {
                    showStoresByCategory(selectedCategory);
                }
            }
            
            closeNoteModal();
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            // Группируем магазины по категориям
            const groupedStores = groupStoresByCategory(storesData);
            const categories = Object.keys(groupedStores).sort();
            
            // Создаем меню категорий
            createCategoryMenu(categories);
            
            // Показываем все магазины
            showAllStores();
            
            // Добавляем обработчики событий
            document.getElementById('searchInput').addEventListener('input', searchStores);
            
            // Обработчики для выпадающего списка категорий
            document.getElementById('categoryToggle').addEventListener('click', () => {
                document.getElementById('categoryDropdown').classList.toggle('show');
            });
            
            // Закрытие выпадающего списка при клике вне его
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.category-select')) {
                    document.getElementById('categoryDropdown').classList.remove('show');
                }
            });
            
            // Обработчики для заметок
            document.addEventListener('click', (e) => {
                if (e.target.closest('.note-btn')) {
                    const storeName = e.target.closest('.note-btn').dataset.store;
                    openNoteModal(storeName);
                }
            });
            
            document.getElementById('closeNoteModal').addEventListener('click', closeNoteModal);
            document.getElementById('cancelNote').addEventListener('click', closeNoteModal);
            document.getElementById('saveNote').addEventListener('click', saveNote);
            
            // Закрытие модального окна при клике вне его
            document.getElementById('noteModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('noteModal')) {
                    closeNoteModal();
                }
            });
        });
    </script>
</body>
</html>
